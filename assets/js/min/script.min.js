(function(e,t,n){e.Site={basePath:t.body.getAttribute("data-base-url"),userAgent:navigator.userAgent,platform:navigator.platform};var r=t.documentElement;r.setAttribute("data-useragent",Site.userAgent);r.setAttribute("data-platform",Site.platform);String.prototype.queryToObj=function(e){e=e||!1;var t,n="",r={},i=0,s;typeof e=="string"&&(n=this.replace(e,""));t=n.split("&"),s=t.length;for(i;i<s;i++){var o=t[i].split("="),u=o[0],a=o[1];r[u]=a}return r};var i={vroom:function(e){e=e||!1;if(e===!1){console.error("Douchebag supplied false arguments");return}this.kickTires(e).lightFires().pedalToTheMetal();return this},pedalToTheMetal:function(){$.get(Site.basePath+"/portfolio.php",this.readyWork);var e="https://api.github.com/users/adamcbrewer/repos?callback=?&type=owner";$.getJSON(e,this.readyGit)},readyWork:function(e){i.work=e.work;i.about=e.about;i[404]=e[404];i.renderWork(e);i.hazWork=!0;i.checkReadyState()},renderWork:function(e){e.type="wide";var t=this.projectlistItemTmpl.render(e);this.$projectList.append(t)},readyGit:function(e){i.hazGit=!0;i.checkReadyState()},checkReadyState:function(){if(this.hazWork){this.relax();if(this.deeplink)this.openProject(this.deeplink);else if(this.search){var e=this.parseSearch(this.search);e.page&&this.openPage(e.page);e.project&&this.openProject(e.project)}}},busy:function(){this.$body.addClass("busy")},relax:function(){this.$body.removeClass("busy")},openProject:function(e){this.busy();var t=this,n,r="",i={},s=!1;if(!(!this.currentProject||e!=="prev"&&e!=="next")){e==="prev"&&this.currentProject.pagination.prev&&this.openProject(this.currentProject.pagination.prev.key);e==="next"&&this.currentProject.pagination.next&&this.openProject(this.currentProject.pagination.next.key);return}n=this.findProject(e);if(n){r=this.projectTmpl.render(n);this.pushState("project",e);this.currentProject=n}else{var o=Math.floor(Math.random()*this[404].length);r=this.fourZeroFourTmpl.render(this[404][o]);this.pushState("page","404")}this.$detail.html(r);t.$body.hasClass("detail-open")||t.$body.addClass("detail-open");imagesLoaded(this.$detail[0],function(){t.relax();t.$detail.find(".project").removeClass("hide")})},paginate:function(e){var t={},n,r;if(typeof e=="number"){n=this.work[e-1];r=this.work[e+1]}n&&(t.prev=n);r&&(t.next=r);return t},findProject:function(e){var t=0,n=this.work,r={};e:for(t;t<n.length;t++)if(n[t].key===e){r=n[t];break e}r.pagination=this.paginate(t);return r},openPage:function(e){e=e||!1;this.busy();var t=this[e],n="";if(e==="work"){this.close();this.pushState(!1)}else if(e==="404"){this.openProject(null);this.pushState(!1)}else if(e==="about"){n=this.aboutTmpl.render(t);this.$detail.html(n);this.$body.addClass("detail-open");this.$detail.find(".hide").removeClass("hide");this.pushState("page",e)}this.relax();this.updatePageNav(e)},updatePageNav:function(e){var t=this.$pageNav.find("a");t.removeClass("current");typeof e=="string"?t.filter('[data-open-page="'+e+'"]').addClass("current"):t.filter('[data-open-page="work"]').addClass("current")},close:function(){this.$body.removeClass("detail-open");this.$detail.find(".project").addClass("hide");this.$detail.html("");this.pushState(!1);this.updatePageNav(!1);e.scrollTo(0,0)},toggleView:function(){this.$body.toggleClass("listview")},parseSearch:function(e){var t;typeof e=="string"?t=e.queryToObj("?"):t=e;return t},pushState:function(t,n){if(this.hasPushstate){if(arguments[0]===!1||arguments[0]===!0){var r=Site.basePath;r.substr(-1,1)!=="/"&&(r+="/");e.history.pushState(null,"",r);return}var i=e.location.search,s=i.queryToObj("?"),o,u=!1;i+=i.indexOf("?")==-1?"?":"";for(o in s){var a=s.hasOwnProperty(o);if(a&&s[o]===n){u=!0;break}}if(!u){i="?"+t+"="+n;var f={};f[t]=n;e.history.pushState(f,i,i)}}},kickTires:function(t){this.$body=t.body;this.$detail=t.detail;this.$pageNav=t.pageNav;this.$projectList=t.projectList;this.projectTmpl=Hogan.compile(t.projectTmpl);this.fourZeroFourTmpl=Hogan.compile(t.fourZeroFourTmpl);this.aboutTmpl=Hogan.compile(t.aboutTmpl);this.projectlistItemTmpl=Hogan.compile(t.projectlistItemTmpl);this.hazWork=!1;this.hazGit=!1;this.hasPushstate=!!e.history&&!!history.pushState;this.deeplink=t.deeplink;this.search=t.search;return this},lightFires:function(){var n=this.$body;n.on("click","[data-project]",function(e){e.preventDefault();var t=this,n=t.getAttribute("data-project");i.openProject(n)});this.$pageNav.find(".nav-select").on("change",function(e){var t=this.selectedIndex,n=this.options[t].getAttribute("data-open-page");i.openPage(n)});var r=[],s="38,38,40,40,37,39,37,39,66,65";n.on("keydown",function(e){var n=e.keyCode;r.push(e.keyCode);if(r.toString().indexOf(s)>=0){$(t).unbind("keydown",arguments.callee);console.log("KONAMI!")}n===27&&i.close();n===9&&i.toggleView();n===37&&i.openProject("prev");n===39&&i.openProject("next")});n.on("click","[data-open-page]",function(e){e.preventDefault();var t=this,n=t.getAttribute("data-open-page");i.openPage(n)});this.hasPushstate&&(e.onpopstate=function(t){e.location.search.indexOf("?")!=-1});return this}};Zepto(function(t){var n=!1,r=e.location.hash,s=e.location.search,o={};if(r.length){r.indexOf("#!")!==-1?r=r.replace("#!",""):r=r.replace("#","");n=r.replace("/","")}else s.length&&(o=s);i.vroom({body:t("body"),detail:t(".detail"),projectList:t(".projectlist"),pageNav:t(".nav"),projectTmpl:t("#tProject").html(),fourZeroFourTmpl:t("#tFourZeroFour").html(),aboutTmpl:t("#tAbout").html(),projectlistItemTmpl:t("#tProjectlistItem").html(),deeplink:n,search:o})})})(window,document);